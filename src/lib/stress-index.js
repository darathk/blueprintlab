
// E1RM Formula provided by user
export function calculateSimpleE1RM(weight, reps, rpe) {
    if (!weight || !reps || !rpe) return 0;
    const rpeValue = parseFloat(rpe);
    const weightValue = parseFloat(weight);
    const repsValue = parseFloat(reps);

    if (isNaN(weightValue) || isNaN(repsValue)) return 0;

    // Epley / BlockReview formula: weight * (1 + (reps + (10 - rpe)) / 30)
    return Math.round(weightValue * (1 + (repsValue + (10 - rpeValue)) / 30));
}

// RTS Stress Index Tables (Transcribed from user image)
// Structure: [RPE][Reps 1-15]
// Note: Arrays are 0-indexed, so index 0 = 1 rep, index 14 = 15 reps.

const TOTAL_STRESS_TABLE = {
    10: [1.2, 1.2, 1.3, 1.3, 1.3, 1.3, 1.3, 1.3, 1.2, 1.2, 1.2, 1.1, 1.1, 1, 1],
    9.5: [1, 1.1, 1.1, 1.2, 1.2, 1.2, 1.2, 1.1, 1.1, 1.1, 1, 1, 0.9, 0.9, 0.9],
    9: [0.9, 1, 1, 1, 1, 1, 1, 1, 1, 0.9, 0.9, 0.9, 0.8, 0.8, 0.7],
    8.5: [0.8, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.8, 0.8, 0.8, 0.7, 0.7, 0.6],
    8: [0.7, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.7, 0.7, 0.7, 0.6, 0.6, 0.6],
    7.5: [0.6, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.6, 0.6, 0.6, 0.6, 0.5, 0.5],
    7: [0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.5, 0.5, 0.5, 0.5, 0.4],
    6.5: [0.5, 0.5, 0.5, 0.6, 0.6, 0.6, 0.5, 0.5, 0.5, 0.5, 0.5, 0.4, 0.4, 0.4, 0.4],
    6: [0.4, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.4, 0.4, 0.4, 0.4, 0.3, 0.3],
    5.5: [0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.3, 0.3, 0.3, 0.3],
    5: [0.3, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.3, 0.3, 0.3, 0.3, 0.3, 0.2, 0.2]
};

const CENTRAL_STRESS_TABLE = {
    10: [1.8, 1.6, 1.4, 1.2, 1.1, 1, 0.8, 0.8, 0.7, 0.6, 0.5, 0.5, 0.4, 0.4, 0.4],
    9.5: [1.6, 1.4, 1.2, 1.1, 0.9, 0.8, 0.7, 0.7, 0.6, 0.5, 0.5, 0.4, 0.4, 0.4, 0.3],
    9: [1.4, 1.2, 1.1, 0.9, 0.8, 0.7, 0.7, 0.6, 0.5, 0.5, 0.4, 0.4, 0.3, 0.3, 0.3],
    8.5: [1.2, 1.1, 0.9, 0.8, 0.7, 0.7, 0.6, 0.5, 0.5, 0.4, 0.4, 0.3, 0.3, 0.3, 0.2],
    8: [1.1, 1, 0.8, 0.7, 0.7, 0.6, 0.5, 0.5, 0.4, 0.4, 0.3, 0.3, 0.3, 0.2, 0.2],
    7.5: [1, 0.8, 0.7, 0.7, 0.6, 0.5, 0.5, 0.4, 0.4, 0.3, 0.3, 0.3, 0.2, 0.2, 0.2],
    7: [0.9, 0.7, 0.7, 0.6, 0.5, 0.5, 0.4, 0.4, 0.3, 0.3, 0.3, 0.2, 0.2, 0.2, 0.2],
    6.5: [0.8, 0.7, 0.6, 0.5, 0.5, 0.4, 0.4, 0.3, 0.3, 0.3, 0.2, 0.2, 0.2, 0.2, 0.1],
    6: [0.7, 0.6, 0.5, 0.5, 0.4, 0.3, 0.3, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.1, 0.1],
    5.5: [0.6, 0.5, 0.5, 0.4, 0.4, 0.3, 0.3, 0.2, 0.2, 0.2, 0.2, 0.1, 0.1, 0.1, 0.1],
    5: [0.5, 0.5, 0.4, 0.4, 0.3, 0.3, 0.2, 0.2, 0.2, 0.2, 0.1, 0.1, 0.1, 0.1, 0.1]
};

const PERIPHERAL_STRESS_TABLE = {
    10: [0.5, 0.9, 1.2, 1.4, 1.6, 1.7, 1.8, 1.8, 1.8, 1.8, 1.8, 1.7, 1.7, 1.7, 1.6],
    9.5: [0.5, 0.8, 1.1, 1.3, 1.4, 1.5, 1.6, 1.6, 1.6, 1.6, 1.6, 1.5, 1.5, 1.5, 1.4],
    9: [0.4, 0.7, 1, 1.1, 1.2, 1.3, 1.4, 1.4, 1.4, 1.4, 1.4, 1.4, 1.3, 1.3, 1.2],
    8.5: [0.4, 0.6, 0.8, 1, 1.1, 1.2, 1.2, 1.2, 1.2, 1.2, 1.2, 1.2, 1.2, 1.1, 1.1],
    8: [0.3, 0.6, 0.7, 0.9, 1, 1, 1.1, 1.1, 1.1, 1.1, 1.1, 1, 1, 1, 0.9],
    7.5: [0.3, 0.5, 0.7, 0.8, 0.9, 0.9, 1, 1, 1, 1, 0.9, 0.9, 0.9, 0.8, 0.8],
    7: [0.3, 0.4, 0.6, 0.7, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.7, 0.7],
    6.5: [0.2, 0.4, 0.5, 0.6, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.6, 0.6],
    6: [0.2, 0.3, 0.5, 0.5, 0.6, 0.6, 0.6, 0.7, 0.7, 0.7, 0.6, 0.6, 0.6, 0.5, 0.5],
    5.5: [0.2, 0.3, 0.4, 0.5, 0.5, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.5, 0.5, 0.5, 0.4],
    5: [0.2, 0.3, 0.4, 0.4, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.4, 0.4, 0.4]
};

function getTableValue(table, rpe, reps) {
    if (reps < 1 || reps > 15) return 0;

    // Normalize RPE (clamp 5-10, round to 0.5)
    let safeRpe = Math.round(rpe * 2) / 2;
    if (safeRpe > 10) safeRpe = 10;
    if (safeRpe < 5) return 0; // Table starts at 5

    // Lookup
    const row = table[safeRpe];
    if (!row) return 0;

    return row[reps - 1]; // 0-indexed
}

export function calculateStress(reps, rpe) {
    if (!reps || !rpe) return { total: 0, central: 0, peripheral: 0 };

    const total = getTableValue(TOTAL_STRESS_TABLE, rpe, reps);
    const central = getTableValue(CENTRAL_STRESS_TABLE, rpe, reps);
    const peripheral = getTableValue(PERIPHERAL_STRESS_TABLE, rpe, reps);

    return { total, central, peripheral };
}
